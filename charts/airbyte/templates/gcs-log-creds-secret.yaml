{{- if and (eq .Values.global.deploymentMode "oss") (eq (lower (default "" .Values.global.storage.type)) "gcs") }}
{{ $gcsConfig := required "You must set 'global.storage.gcs' when setting 'global.storage.type' to 'gcs'" .Values.global.storage.gcs }}
{{ $credentialsJson := required  "You must set 'global.storage.gcs.credentialsJson' when setting 'global.storage.type' to 'gcs'" .Values.global.storage.gcs.credentialsJson }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ .Release.Name }}-gcs-log-creds
  labels:
    {{- include "airbyte.labels" . | nindent 4 }}
type: Opaque
data:
  gcp.json: {{ $credentialsJson | default ""  | quote }}
{{- end }}

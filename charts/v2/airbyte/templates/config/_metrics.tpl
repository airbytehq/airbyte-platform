
{{/* DO NOT EDIT: This file was autogenerated. */}}

{{/*
    Metrics Configuration
*/}}

{{/*
Renders the global.metrics.enabled value
*/}}
{{- define "airbyte.metrics.enabled" }}
	{{- if eq .Values.global.metrics.enabled nil }}
    	{{- false }}
	{{- else }}
    	{{- .Values.global.metrics.enabled }}
	{{- end }}
{{- end }}

{{/*
Renders the metrics.enabled environment variable
*/}}
{{- define "airbyte.metrics.enabled.env" }}
- name: MICROMETER_METRICS_ENABLED
  valueFrom:
    configMapKeyRef:
      name: {{ .Release.Name }}-airbyte-env
      key: MICROMETER_METRICS_ENABLED
{{- end }}

{{/*
Renders the global.metrics.step value
*/}}
{{- define "airbyte.metrics.step" }}
    {{- .Values.global.metrics.step | default "PT1M" }}
{{- end }}

{{/*
Renders the metrics.step environment variable
*/}}
{{- define "airbyte.metrics.step.env" }}
- name: MICROMETER_METRICS_STEP
  valueFrom:
    configMapKeyRef:
      name: {{ .Release.Name }}-airbyte-env
      key: MICROMETER_METRICS_STEP
{{- end }}

{{/*
Renders the global.metrics.statsd.flavor value
*/}}
{{- define "airbyte.metrics.statsd.flavor" }}
    {{- .Values.global.metrics.statsd.flavor | default "datadog" }}
{{- end }}

{{/*
Renders the metrics.statsd.flavor environment variable
*/}}
{{- define "airbyte.metrics.statsd.flavor.env" }}
- name: MICROMETER_METRICS_STATSD_FLAVOR
  valueFrom:
    configMapKeyRef:
      name: {{ .Release.Name }}-airbyte-env
      key: MICROMETER_METRICS_STATSD_FLAVOR
{{- end }}

{{/*
Renders the global.metrics.otlp.enabled value
*/}}
{{- define "airbyte.metrics.otlp.enabled" }}
	{{- if eq .Values.global.metrics.otlp.enabled nil }}
    	{{- false }}
	{{- else }}
    	{{- .Values.global.metrics.otlp.enabled }}
	{{- end }}
{{- end }}

{{/*
Renders the metrics.otlp.enabled environment variable
*/}}
{{- define "airbyte.metrics.otlp.enabled.env" }}
- name: MICROMETER_METRICS_OTLP_ENABLED
  valueFrom:
    configMapKeyRef:
      name: {{ .Release.Name }}-airbyte-env
      key: MICROMETER_METRICS_OTLP_ENABLED
{{- end }}

{{/*
Renders the global.metrics.statsd.enabled value
*/}}
{{- define "airbyte.metrics.statsd.enabled" }}
	{{- if eq .Values.global.metrics.statsd.enabled nil }}
    	{{- false }}
	{{- else }}
    	{{- .Values.global.metrics.statsd.enabled }}
	{{- end }}
{{- end }}

{{/*
Renders the metrics.statsd.enabled environment variable
*/}}
{{- define "airbyte.metrics.statsd.enabled.env" }}
- name: MICROMETER_METRICS_STATSD_ENABLED
  valueFrom:
    configMapKeyRef:
      name: {{ .Release.Name }}-airbyte-env
      key: MICROMETER_METRICS_STATSD_ENABLED
{{- end }}

{{/*
Renders the global.metrics.otlp.collectorEndpoint value
*/}}
{{- define "airbyte.metrics.otlp.collectorEndpoint" }}
    {{- .Values.global.metrics.otlp.collectorEndpoint }}
{{- end }}

{{/*
Renders the metrics.otlp.collectorEndpoint environment variable
*/}}
{{- define "airbyte.metrics.otlp.collectorEndpoint.env" }}
- name: OTEL_COLLECTOR_ENDPOINT
  valueFrom:
    configMapKeyRef:
      name: {{ .Release.Name }}-airbyte-env
      key: OTEL_COLLECTOR_ENDPOINT
{{- end }}

{{/*
Renders the global.metrics.publish value
*/}}
{{- define "airbyte.metrics.publish" }}
	{{- if eq .Values.global.metrics.publish nil }}
    	{{- true }}
	{{- else }}
    	{{- .Values.global.metrics.publish }}
	{{- end }}
{{- end }}

{{/*
Renders the metrics.publish environment variable
*/}}
{{- define "airbyte.metrics.publish.env" }}
- name: PUBLISH_METRICS
  valueFrom:
    configMapKeyRef:
      name: {{ .Release.Name }}-airbyte-env
      key: PUBLISH_METRICS
{{- end }}

{{/*
Renders the global.metrics.statsd.host value
*/}}
{{- define "airbyte.metrics.statsd.host" }}
    {{- .Values.global.metrics.statsd.host }}
{{- end }}

{{/*
Renders the metrics.statsd.host environment variable
*/}}
{{- define "airbyte.metrics.statsd.host.env" }}
- name: STATSD_HOST
  valueFrom:
    fieldRef:
      fieldPath: status.hostIP
    
{{- end }}

{{/*
Renders the global.metrics.statsd.port value
*/}}
{{- define "airbyte.metrics.statsd.port" }}
    {{- .Values.global.metrics.statsd.port | default 8125 }}
{{- end }}

{{/*
Renders the metrics.statsd.port environment variable
*/}}
{{- define "airbyte.metrics.statsd.port.env" }}
- name: STATSD_PORT
  valueFrom:
    configMapKeyRef:
      name: {{ .Release.Name }}-airbyte-env
      key: STATSD_PORT
{{- end }}

{{/*
Renders the set of all metrics environment variables
*/}}
{{- define "airbyte.metrics.envs" }}
{{- include "airbyte.metrics.enabled.env" . }}
{{- include "airbyte.metrics.step.env" . }}
{{- include "airbyte.metrics.statsd.flavor.env" . }}
{{- include "airbyte.metrics.otlp.enabled.env" . }}
{{- include "airbyte.metrics.statsd.enabled.env" . }}
{{- include "airbyte.metrics.otlp.collectorEndpoint.env" . }}
{{- include "airbyte.metrics.publish.env" . }}
{{- include "airbyte.metrics.statsd.host.env" . }}
{{- include "airbyte.metrics.statsd.port.env" . }}
{{- end }}

{{/*
Renders the set of all metrics config map variables
*/}}
{{- define "airbyte.metrics.configVars" }}
MICROMETER_METRICS_ENABLED: {{ include "airbyte.metrics.enabled" . | quote }}
MICROMETER_METRICS_STEP: {{ include "airbyte.metrics.step" . | quote }}
MICROMETER_METRICS_STATSD_FLAVOR: {{ include "airbyte.metrics.statsd.flavor" . | quote }}
MICROMETER_METRICS_OTLP_ENABLED: {{ include "airbyte.metrics.otlp.enabled" . | quote }}
MICROMETER_METRICS_STATSD_ENABLED: {{ include "airbyte.metrics.statsd.enabled" . | quote }}
OTEL_COLLECTOR_ENDPOINT: {{ include "airbyte.metrics.otlp.collectorEndpoint" . | quote }}
PUBLISH_METRICS: {{ include "airbyte.metrics.publish" . | quote }}
STATSD_HOST: {{ include "airbyte.metrics.statsd.host" . | quote }}
STATSD_PORT: {{ include "airbyte.metrics.statsd.port" . | quote }}
{{- end }}

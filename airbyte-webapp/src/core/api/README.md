# Core API requests

This folder contains all the code to talk to the backend APIs of Airbyte.

**Outside of this folder you must only ever import from either `core/api`, `core/api/cloud`(for
cloud specific APIs), or `core/api/types/*` (for the
request/response types).**

All other files should be considered local to the API implementation and only used inside
this folder. This should prevent accidentally diverging from an aligned request architecture.
This is validated via an ESLint rule.

## Auto generating

We generate the request/response types as well as the actual methods calling
those endpoints using [Orval](https://orval.dev/) during the `prestart`/`prebuild` phase.

Those files will be generated into the `generated/` subfolder and are not part of git. Orval
will also generate the files under `types/` to re-export the types and enums to be consumed
outside this folder.

## Structure

### `apiCall.ts`

The base API method `fetchApiCall` which will be used to execute requests against APIs. It should only be used by the individual APIs implementation in `apis.ts`.

### `apis.ts`

The API specific methods, which call `fetchApiCall` and pass the correct base API url for the given API. When adding a new API you must make sure to export a new function from this file, that calls `fetchApiCall` with the correct base url of that API.

### `types/`

The type/enum-only re-export from the generated files, that are meant to be imported outside this module to get access to request/response typings. Those files are auto generated by Orval as well.

### `hooks/`

The react-query wrapping hooks that will be used by our code to execute queries. Those hooks are written manually and should usually use either `useQuery`, `useMutation` or `useSuspenseQuery` (from `useSuspenseQuery.ts`) to make the query. Which one to use might depend on the specific use-case. Modifying hooks usually will use `useMutation`, data retrieving hooks usually `useSuspenseQuery`, unless there is a need to handle the loading state not via the suspense fallback but inside the component itself.

APIs that are only available in Cloud should be implemented under `hooks/cloud/` to make the availability clearer and re-exported via `hooks/cloud/index.ts`. That will make them available under `core/api/cloud` in the rest of the app, and thus easier to notice that they are Cloud only.

All hooks in `core/hooks/` directly should be re-exported in the `core/api/hooks/index.ts` file so they'll be available under `core/api` to be used in the rest of the application.

### `useRequestOptions.ts`

A hook whose output will need to be passed into the last argument of any function inside `generated/`. It will pass through required parameters (e.g. auth token) to the `fetchApiCall` method.

### `errors/`

Contains API code specific error classes
